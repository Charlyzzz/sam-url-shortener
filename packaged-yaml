AWSTemplateFormatVersion: '2010-09-09'
Description: 'url-shortener

  Sample SAM Template

  '
Globals:
  Function:
    Environment:
      Variables:
        DB_ENDPOINT: http://dynamodb.us-west-2.amazonaws.com
        REGION_NAME: us-west-2
        URLS_TABLE:
          Ref: DynamoUrlsTable
    Timeout: 3
Outputs:
  HelloWorldApi:
    Description: API Gateway endpoint URL for Prod stage for Hello World function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/hello/
  HelloWorldFunction:
    Description: Hello World Lambda Function ARN
    Value:
      Fn::GetAtt:
      - HelloWorldFunction
      - Arn
  HelloWorldFunctionIamRole:
    Description: Implicit IAM Role created for Hello World function
    Value:
      Fn::GetAtt:
      - HelloWorldFunctionRole
      - Arn
Resources:
  DynamoUrlsTable:
    PrimaryKey:
      Name: path
      Type: String
    ProvisionedThroughput:
      ReadCapacityUnit: 5
      WriteCapacityUnits: 5
    TableName: urls
    Tags:
      AppType: Serverless
    Type: AWS::Serverless::SimpleTable
  HelloWorldFunction:
    Properties:
      CodeUri: s3://edebusschere-sam-url-shortener/b76cc371d8a1b71a834d964450ea173b
      Events:
        HelloWorld:
          Properties:
            Method: get
            Path: /{slug}
          Type: Api
      Handler: app.lambda_handler
      Policies: AmazonDynamoDBFullAccess
      Runtime: python3.7
    Type: AWS::Serverless::Function
Transform: AWS::Serverless-2016-10-31
